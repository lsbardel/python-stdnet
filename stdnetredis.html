
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Stdnet Redis branch &mdash; python stdnet v0.7.0 documentation</title>
    <link rel="stylesheet" href="static/celery.css" type="text/css" />
    <link rel="stylesheet" href="static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '0.7.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="static/jquery.js"></script>
    <script type="text/javascript" src="static/underscore.js"></script>
    <script type="text/javascript" src="static/doctools.js"></script>
    <link rel="top" title="python stdnet v0.7.0 documentation" href="index.html" />
    <link rel="next" title="Changelog" href="changelog.html" />
    <link rel="prev" title="Internals and Utilities" href="utility.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="changelog.html" title="Changelog"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="utility.html" title="Internals and Utilities"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">python stdnet v0.7.0 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="stdnet-redis-branch">
<span id="stdnetredis"></span><h1>Stdnet Redis branch<a class="headerlink" href="#stdnet-redis-branch" title="Permalink to this headline">¶</a></h1>
<p>During the development of <a class="reference external" href="http://lsbardel.github.com/python-stdnet/">stdnet</a> we came across several design decisions, some
more critical than others, and most of them were resolved coding the client
only. However, more exotic features, such as the time series structure,
required hacking on the server side.</p>
<p>For this reason we have the <a class="reference external" href="https://github.com/lsbardel/redis">stdnet-redis</a> branch.</p>
<div class="section" id="sorted-sets">
<h2>Sorted sets<a class="headerlink" href="#sorted-sets" title="Permalink to this headline">¶</a></h2>
<p>For some reasons redis does not have a <tt class="docutils literal"><span class="pre">zdiffstore</span></tt> command.
For 99% of applications this is not an issue, but when using <a class="reference external" href="http://lsbardel.github.com/python-stdnet/">stdnet</a> with
models which have an <a class="reference internal" href="examples/sorting.html#implicit-sorting"><em>implicit sorting</em></a> it becomes one.</p>
<div class="section" id="zdiffstore">
<h3>ZDIFFSTORE<a class="headerlink" href="#zdiffstore" title="Permalink to this headline">¶</a></h3>
<p>Computes the difference between the first sorted set and all the successive sorted sets
given by the specified keys, and stores the result in destination.
It is mandatory to provide the number of input keys (numkeys)
before passing the input keys and the other (optional) arguments:</p>
<div class="highlight-python"><pre>ZDIFFSTORE destination numkeys key [key ...] [withscore]</pre>
</div>
<p>If the optional argument <tt class="docutils literal"><span class="pre">withscore</span></tt> is <tt class="xref docutils literal"><span class="pre">True</span></tt> (default is <tt class="xref docutils literal"><span class="pre">False</span></tt>), elements are
removed from the first sorted sets only if the score is matched.</p>
</div>
</div>
<div class="section" id="time-series">
<span id="redis-timeseries"></span><h2>Time-series<a class="headerlink" href="#time-series" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="http://en.wikipedia.org/wiki/Time_series">Time-series</a> is an important
data-structure not yet supported in redis, it is represented by a unique sorted
associative container, that is to say it associates ordered unique times to values.</p>
<p>Values, which can be anything you like, are ordered with respect to times
(you could use unix timestamp, but any double value would do),
and can be accessed by times or rank (the order of times in the time-series).
Times are unique so that there will be only one value associated with a given time.</p>
<p>Internally, a time-series is implemented using the same skiplist implementation
as ordered sets.
Values are added to a skip list which maintain sorting with respect to times.</p>
<p>Performance:</p>
<div class="highlight-python"><pre>O(log(N)) on INSERT REMOVE and RETRIEVAL via times</pre>
</div>
<p>There are currently seven commands which cover the basic operations of a timeseries. I tried to keep them to a minimum
but there is scope to add more.</p>
<div class="section" id="tslen">
<h3>TSLEN<a class="headerlink" href="#tslen" title="Permalink to this headline">¶</a></h3>
<p>Size of timeseries at <tt class="docutils literal"><span class="pre">key</span></tt>, that is the number of <tt class="docutils literal"><span class="pre">rows</span></tt> in the timeseries:</p>
<div class="highlight-python"><pre>tslen key</pre>
</div>
</div>
<div class="section" id="tsadd">
<h3>TSADD<a class="headerlink" href="#tsadd" title="Permalink to this headline">¶</a></h3>
<p>Add items to timeseries at <tt class="docutils literal"><span class="pre">key</span></tt>:</p>
<div class="highlight-python"><pre>tsadd key time1 value1 time2 value2 ...</pre>
</div>
<p>If value at <tt class="docutils literal"><span class="pre">time</span></tt> is already available, the value will be updated.</p>
</div>
<div class="section" id="tsexists">
<h3>TSEXISTS<a class="headerlink" href="#tsexists" title="Permalink to this headline">¶</a></h3>
<p>Check if <tt class="docutils literal"><span class="pre">time</span></tt> is in timeseries at <tt class="docutils literal"><span class="pre">key</span></tt>:</p>
<div class="highlight-python"><pre>tsexists key time</pre>
</div>
</div>
<div class="section" id="tsrank">
<h3>TSRANK<a class="headerlink" href="#tsrank" title="Permalink to this headline">¶</a></h3>
<p>Returns the rank (index position) of <tt class="docutils literal"><span class="pre">time</span></tt> in timeseries at <tt class="docutils literal"><span class="pre">key</span></tt>:</p>
<div class="highlight-python"><pre>tsrank key time</pre>
</div>
</div>
<div class="section" id="tsget">
<h3>TSGET<a class="headerlink" href="#tsget" title="Permalink to this headline">¶</a></h3>
<p>Get value at <tt class="docutils literal"><span class="pre">time</span></tt> in timeseries at <tt class="docutils literal"><span class="pre">key</span></tt>:</p>
<div class="highlight-python"><pre>tsget key time</pre>
</div>
</div>
<div class="section" id="tsrange">
<h3>TSRANGE<a class="headerlink" href="#tsrange" title="Permalink to this headline">¶</a></h3>
<p>Range by rank:</p>
<div class="highlight-python"><pre>tsrange key start end &lt;flag&gt;</pre>
</div>
<p>Where <tt class="docutils literal"><span class="pre">start</span></tt> and <tt class="docutils literal"><span class="pre">end</span></tt> are integers following the same
Redis conventions as <tt class="docutils literal"><span class="pre">zrange</span></tt>, <tt class="docutils literal"><span class="pre">&lt;flag&gt;</span></tt> is an optional
string which can take two values: <tt class="docutils literal"><span class="pre">withtimes</span></tt> or <tt class="docutils literal"><span class="pre">novalues</span></tt>:</p>
<div class="highlight-python"><pre>tsrange key start end           -&gt; return values
tsrange key start end withtimes -&gt; return (time,value)s
tsrange key start end novalues  -&gt; return times</pre>
</div>
</div>
<div class="section" id="tsrangebytime">
<h3>TSRANGEBYTIME<a class="headerlink" href="#tsrangebytime" title="Permalink to this headline">¶</a></h3>
<p>Range by times:</p>
<div class="highlight-python"><pre>tsrangebytime key time_start time_end &lt;flag&gt;</pre>
</div>
<p>Where <tt class="docutils literal"><span class="pre">time_start</span></tt> and <tt class="docutils literal"><span class="pre">time_end</span></tt> are double (timestaps) and <tt class="docutils literal"><span class="pre">&lt;flag&gt;</span></tt>
is the same as in <tt class="docutils literal"><span class="pre">TSRANGE</span></tt>.</p>
</div>
<div class="section" id="tscount">
<h3>TSCOUNT<a class="headerlink" href="#tscount" title="Permalink to this headline">¶</a></h3>
<p>Count element in range by <tt class="docutils literal"><span class="pre">time</span></tt>:</p>
<div class="highlight-python"><pre>tscount key time_start,time_end</pre>
</div>
<p>This command is similar to <a class="reference external" href="http://redis.io/commands/zcount">ZCOUNT</a> for sorted sets.</p>
</div>
</div>
<div class="section" id="source-code-changes">
<h2>Source code changes<a class="headerlink" href="#source-code-changes" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>Added 2 files in <tt class="docutils literal"><span class="pre">src</span></tt>: <tt class="docutils literal"><span class="pre">t_ts.h</span></tt> and <tt class="docutils literal"><span class="pre">t_ts.c</span></tt>.</li>
<li>Modified <tt class="docutils literal"><span class="pre">redis.c</span></tt> to add extra commands to the command table and added the <tt class="docutils literal"><span class="pre">t_ts.h</span></tt> include.</li>
<li>Modified <tt class="docutils literal"><span class="pre">Makefile</span></tt> so that <tt class="docutils literal"><span class="pre">t_ts.c</span></tt> is compiled.</li>
<li>Modified <tt class="docutils literal"><span class="pre">object.c</span></tt> in <tt class="docutils literal"><span class="pre">decrRefCount</span></tt> and added <tt class="docutils literal"><span class="pre">t_ts.h</span></tt> include.</li>
<li>Modified <tt class="docutils literal"><span class="pre">db.c</span></tt> in <tt class="docutils literal"><span class="pre">typeCommand</span></tt> and added <tt class="docutils literal"><span class="pre">t_ts.h</span></tt> include.</li>
<li>Modified <tt class="docutils literal"><span class="pre">rdb.c</span></tt> in <tt class="docutils literal"><span class="pre">rdbSaveObject</span></tt> and <tt class="docutils literal"><span class="pre">rdbLoadObject</span></tt> and added <tt class="docutils literal"><span class="pre">t_ts.h</span></tt> include.</li>
</ul>
<div class="section" id="t-zset-c">
<h3>t_zset.c<a class="headerlink" href="#t-zset-c" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Modified so that <tt class="docutils literal"><span class="pre">t_ts.c</span></tt> can use its internals.</li>
<li>Modified <tt class="docutils literal"><span class="pre">zunionInterGenericCommand</span></tt> function to accommodate the ZDIFFSTORE command.</li>
</ul>
</div>
<div class="section" id="tests">
<h3>Tests<a class="headerlink" href="#tests" title="Permalink to this headline">¶</a></h3>
<p>Added 1 file in <tt class="docutils literal"><span class="pre">tests/unit/type</span></tt>: <tt class="docutils literal"><span class="pre">ts.tcl</span></tt>.</p>
<p>To run the timeseries tests:</p>
<div class="highlight-python"><pre>make test TAGS="ts"</pre>
</div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper"><p class="logo">
<a href="index.html">
  <img class="logo" width="200" src="static/net.jpg" alt="Logo"/>
</a>
</p>
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Stdnet Redis branch</a><ul>
<li><a class="reference internal" href="#sorted-sets">Sorted sets</a><ul>
<li><a class="reference internal" href="#zdiffstore">ZDIFFSTORE</a></li>
</ul>
</li>
<li><a class="reference internal" href="#time-series">Time-series</a><ul>
<li><a class="reference internal" href="#tslen">TSLEN</a></li>
<li><a class="reference internal" href="#tsadd">TSADD</a></li>
<li><a class="reference internal" href="#tsexists">TSEXISTS</a></li>
<li><a class="reference internal" href="#tsrank">TSRANK</a></li>
<li><a class="reference internal" href="#tsget">TSGET</a></li>
<li><a class="reference internal" href="#tsrange">TSRANGE</a></li>
<li><a class="reference internal" href="#tsrangebytime">TSRANGEBYTIME</a></li>
<li><a class="reference internal" href="#tscount">TSCOUNT</a></li>
</ul>
</li>
<li><a class="reference internal" href="#source-code-changes">Source code changes</a><ul>
<li><a class="reference internal" href="#t-zset-c">t_zset.c</a></li>
<li><a class="reference internal" href="#tests">Tests</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="utility.html"
                        title="previous chapter">Internals and Utilities</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="changelog.html"
                        title="next chapter">Changelog</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="sources/stdnetredis.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" size="18" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="changelog.html" title="Changelog"
             >next</a> |</li>
        <li class="right" >
          <a href="utility.html" title="Internals and Utilities"
             >previous</a> |</li>
        <li><a href="index.html">python stdnet v0.7.0 documentation</a> &raquo;</li> 
      </ul>
    </div>

    <div class="footer">
        &copy; Copyright 2010-2011, Luca Sbardella.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.0.7.
    </div>
<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-3900561-6']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>

  </body>
</html>